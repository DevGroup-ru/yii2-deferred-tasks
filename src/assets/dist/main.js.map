{"version":3,"sources":["main.js"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["\n\nclass ReportingQueueItem {\n  constructor() {\n    this.timeouts = {};\n  }\n\n  reportQueueItem(queueItemId, params) {\n    const options = ReportingQueueItem.defaultParams(params);\n    const modal = this.initModal(options);\n    const messageElement = modal.find('.reporting-queue-item__message');\n    const outputElement = modal.find('.reporting-queue-item__output');\n    const statusElement = modal.find('.reporting-queue-item__status');\n    messageElement.text(options.requestingStatusMessage);\n    modal.modal('show');\n    ReportingQueueItem.requestAndUpdate(queueItemId, options.endpoint, options.outputRequestInterval, outputElement, statusElement, 0);\n    const that = this;\n    modal.on('hide.bs.modal', function onHideRemoveTimeout() {\n      if (that.timeouts.hasOwnProperty(queueItemId)) {\n        clearTimeout(that.timeouts[queueItemId]);\n      }\n    });\n  }\n\n  static requestAndUpdate(queueItemId, endpoint, outputRequestInterval, outputElement, statusElement, lastFseekPosition = 0) {\n    const that = this;\n    $.ajax({\n      url: endpoint,\n      data: {\n        'queueItemId': queueItemId,\n        'lastFseekPosition': lastFseekPosition,\n      },\n      success: function success(data) {\n        if (data.error) {\n          outputElement.parent().find('.reporting-queue-item__message').text(data.errorMessage);\n        }\n\n        outputElement.append(data.newOutput);\n\n        const height = outputElement[0].scrollHeight;\n\n        outputElement.scrollTop(height);\n\n        let statusText = '';\n        switch (data.status) {\n          case 0:\n            statusText = 'disabled';\n            break;\n          case 1:\n            statusText = 'scheduled';\n            break;\n          case 2:\n            statusText = 'running';\n            break;\n          case 3:\n            statusText = 'failed';\n            break;\n          case 4:\n            statusText = 'complete';\n            break;\n          default:\n            statusText = 'unknown';\n        }\n        statusElement.text(statusText);\n\n        if (data.status <= 2) {\n          outputElement.parent().find('.reporting-queue-item__message').text('Processing');\n          window.reportingQueueItem.timeouts[queueItemId] = setTimeout(\n            function refresh() {\n              ReportingQueueItem.requestAndUpdate(queueItemId, endpoint, outputRequestInterval, outputElement, statusElement, data.lastFseekPosition);\n            },\n            outputRequestInterval\n          );\n        } else {\n          outputElement.parent().find('.reporting-queue-item__message').text('Complete');\n          delete this.timeouts[queueItemId];\n        }\n      },\n    });\n  }\n\n  static defaultParams(params) {\n    return {\n      'modalTitle': params.modalTitle || 'Background task',\n      'closeButtonLabel': params.closeButtonLabel || 'Close',\n      'statusLabel': params.statusLabel || 'Status:',\n      'requestingStatusMessage': params.requestingStatusMessage || 'Requesting queue item information.',\n      'outputRequestInterval': 1000,\n      'endpoint': params.endpoint || '/deferred-report-queue-item',\n    };\n  }\n\n  initModal(params) {\n    const element = $(`<div class=\"modal modal-notifier bounceInUp animated\">`);\n    const dialog = $(`<div class=\"modal-dialog modal-dialog--reporting-queue-item\">`);\n    const dialogContent = $(`<div class=\"modal-content\">`);\n\n    const header = $(`\n    <div class=\"modal-header with-border\">\n      <div class=\"modal-tools pull-right\">\n       <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n      </div>\n      <h4 class=\"modal-title\">${params.modalTitle}</h4>\n    </div>`);\n\n    const body = $(`\n    <div class=\"modal-body\">\n      <div class=\"reporting-queue-item\">\n        ${params.statusLabel} <span class=\"reporting-queue-item__status\">???</span>\n        <div class=\"reporting-queue-item__message\"></div>\n        <pre class=\"reporting-queue-item__output\"></pre>\n      </div>\n    </div>`);\n\n    // hide if timeout is set\n    if (params.timeout !== false) {\n      setTimeout(function hide() {\n        // add bounce out animation\n        element\n          .removeClass('bounceInUp')\n          .addClass('bounceOutDown')\n          .one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend',\n            function complete() {\n              // remove element as soon as animation complete\n              element.remove();\n            }\n          );\n      }, params.timeout);\n    }\n\n    dialogContent\n      .append(header)\n      .append(body);\n    dialog.append(dialogContent);\n\n    element\n      .append(dialog)\n      .hide();\n\n    $('body').append(element);\n\n    return element;\n  }\n\n  executeRouteWithReportingQueueItem(route, data = {}, method = 'POST', params = {}) {\n    const that = this;\n    $.ajax({\n      url: route,\n      'data': data,\n      'method': method,\n      success: function ok(queueData) {\n        if (queueData.queueItemId) {\n          that.reportQueueItem(queueData.queueItemId, params);\n        } else {\n          alert('No queueItemId returned from application.');\n        }\n      },\n      error: function errr(jqXHR, textStatus, errorThrown) {\n        alert(textStatus + '\\n' + errorThrown);\n      },\n    });\n  }\n}\n\nwindow.reportingQueueItem = new ReportingQueueItem();\n\n\n"],"sourceRoot":"/source/"}