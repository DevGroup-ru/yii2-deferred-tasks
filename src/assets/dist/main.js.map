{"version":3,"sources":["main.js"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["\n\nclass ReportingQueueItem {\n  constructor() {\n    this.timeouts = {};\n  }\n\n  reportQueueItem(queueItemId, params) {\n    const options = ReportingQueueItem.defaultParams(params);\n    const modal = this.initModal(options);\n    const messageElement = modal.find('.reporting-queue-item__message');\n    const outputElement = modal.find('.reporting-queue-item__output');\n    const statusElement = modal.find('.reporting-queue-item__status');\n    messageElement.text(options.requestingStatusMessage);\n    modal.modal('show');\n    ReportingQueueItem.requestAndUpdate(queueItemId, options.endpoint, options.outputRequestInterval, outputElement, statusElement, 0, options.afterCallback);\n    const that = this;\n    modal.on('hide.bs.modal', function onHideRemoveTimeout() {\n      if (that.timeouts.hasOwnProperty(queueItemId)) {\n        clearTimeout(that.timeouts[queueItemId]);\n      }\n    });\n  }\n\n  static requestAndUpdate(queueItemId, endpoint, outputRequestInterval, outputElement, statusElement, lastFseekPosition = 0, afterCallback = undefined) {\n    const that = this;\n    $.ajax({\n      url: endpoint,\n      data: {\n        'queueItemId': queueItemId,\n        'lastFseekPosition': lastFseekPosition,\n      },\n      success: function success(data) {\n        if (data.error) {\n          outputElement.parent().find('.reporting-queue-item__message').text(data.errorMessage);\n        }\n\n        outputElement.append(data.newOutput);\n\n        const height = outputElement[0].scrollHeight;\n\n        outputElement.scrollTop(height);\n\n        let statusText = '';\n        switch (data.status) {\n          case 0:\n            statusText = 'disabled';\n            break;\n          case 1:\n            statusText = 'scheduled';\n            break;\n          case 2:\n            statusText = 'running';\n            break;\n          case 3:\n            statusText = 'failed';\n            break;\n          case 4:\n            statusText = 'complete';\n            break;\n          case 5:\n            queueItemId = data.nextQueue;\n            statusText = 'running next';\n            break;\n          default:\n            statusText = 'unknown';\n        }\n        statusElement.text(statusText);\n\n        if ([0,1,2,5].indexOf(data.status) !== -1) {\n          outputElement.parent().find('.reporting-queue-item__message').text('Processing');\n          window.reportingQueueItem.timeouts[queueItemId] = setTimeout(\n            function refresh() {\n              ReportingQueueItem.requestAndUpdate(queueItemId, endpoint, outputRequestInterval, outputElement, statusElement, data.lastFseekPosition, afterCallback);\n            },\n            outputRequestInterval\n          );\n        } else {\n          outputElement.parent().find('.reporting-queue-item__message').text('Complete');\n          if (afterCallback && afterCallback.constructor && afterCallback.call && afterCallback.apply) {\n              afterCallback(outputElement, data.status);\n          }\n          if (that.timeouts && that.timeouts.hasOwnProperty(queueItemId)) {\n              clearTimeout(that.timeouts[queueItemId]);\n          }\n        }\n      },\n    });\n  }\n\n  static defaultParams(params) {\n    return {\n      'modalTitle': params.modalTitle || 'Background task',\n      'closeButtonLabel': params.closeButtonLabel || 'Close',\n      'statusLabel': params.statusLabel || 'Status:',\n      'requestingStatusMessage': params.requestingStatusMessage || 'Requesting queue item information.',\n      'outputRequestInterval': 1000,\n      'endpoint': params.endpoint || '/deferred-report-queue-item',\n      'afterCallback' : params.afterCallback || undefined,\n    };\n  }\n\n  initModal(params) {\n    const element = $(`<div class=\"modal modal-notifier bounceInUp animated\">`);\n    const dialog = $(`<div class=\"modal-dialog modal-dialog--reporting-queue-item\">`);\n    const dialogContent = $(`<div class=\"modal-content\">`);\n\n    const header = $(`\n    <div class=\"modal-header with-border\">\n      <div class=\"modal-tools pull-right\">\n       <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n      </div>\n      <h4 class=\"modal-title\">${params.modalTitle}</h4>\n    </div>`);\n\n    const body = $(`\n    <div class=\"modal-body\">\n      <div class=\"reporting-queue-item\">\n        ${params.statusLabel} <span class=\"reporting-queue-item__status\">???</span>\n        <div class=\"reporting-queue-item__message\"></div>\n        <pre class=\"reporting-queue-item__output\"></pre>\n      </div>\n    </div>`);\n\n    // hide if timeout is set\n    if (params.timeout !== false) {\n      setTimeout(function hide() {\n        // add bounce out animation\n        element\n          .removeClass('bounceInUp')\n          .addClass('bounceOutDown')\n          .one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend',\n            function complete() {\n              // remove element as soon as animation complete\n              element.remove();\n            }\n          );\n      }, params.timeout);\n    }\n\n    dialogContent\n      .append(header)\n      .append(body);\n    dialog.append(dialogContent);\n\n    element\n      .append(dialog)\n      .hide();\n\n    $('body').append(element);\n\n    return element;\n  }\n\n  executeRouteWithReportingQueueItem(route, data = {}, method = 'POST', params = {}) {\n    const that = this;\n    $.ajax({\n      url: route,\n      'data': data,\n      'method': method,\n      success: function ok(queueData) {\n        if (queueData.queueItemId) {\n          that.reportQueueItem(queueData.queueItemId, params);\n        } else {\n          alert('No queueItemId returned from application.');\n        }\n      },\n      error: function errr(jqXHR, textStatus, errorThrown) {\n        alert(textStatus + '\\n' + errorThrown);\n      },\n    });\n  }\n}\n\nwindow.reportingQueueItem = new ReportingQueueItem();\n\n\n"],"sourceRoot":"/source/"}